@model ProfsMarkovHub.ViewModels.BlogIndexViewModel

@{
    ViewData["Title"] = "Blog";
}

<div class="blog-header text-center mb-5">
    <h1 class="display-4">Blog</h1>
    <p class="lead text-muted-custom">Latest insights, reviews, and deep dives.</p>
</div>

@if (!string.IsNullOrWhiteSpace(Model.TagFilter))
{
    <div class="text-center mb-4">
        <span class="tag-pill tag-active">@Model.TagFilter</span>
        <a asp-action="Index" class="btn btn-sm btn-outline-light ms-2">‚úï Clear filter</a>
    </div>
}

<div class="blog-grid">
    @foreach (var article in Model.Articles)
    {
        var wordCount = article.Content.Split(' ', StringSplitOptions.RemoveEmptyEntries).Length;
        var readingTime = Math.Max(1, wordCount / 200);

        <a asp-action="DetailsBySlug" asp-route-slug="@article.Slug" class="blog-card-link">
            <div class="glass-card blog-card">
                @if (!string.IsNullOrEmpty(article.ImageUrl))
                {
                    <img src="@article.ImageUrl" class="blog-image" alt="@article.Title" />
                }
                else
                {
                    <div class="blog-image-placeholder">
                        <span>üìù</span>
                    </div>
                }
                <div class="blog-card-body">
                    <div class="blog-card-meta">
                        <span class="blog-date">@article.PublishedAt.ToString("MMM dd, yyyy")</span>
                        <span class="blog-reading-time">@readingTime min read</span>
                    </div>
                    <h3 class="blog-card-title">@article.Title</h3>
                    <p class="blog-card-excerpt">
                        @if (!string.IsNullOrEmpty(article.Excerpt))
                        {
                            @article.Excerpt
                        }
                        else
                        {
                            @(article.Content.Length > 150 ? article.Content[..150] + "..." : article.Content)
                        }
                    </p>
                    @if (article.ArticleTags?.Any() == true)
                    {
                        <div class="blog-tags">
                            @foreach (var at in article.ArticleTags)
                            {
                                <a asp-action="Index" asp-route-tag="@at.Tag?.Name"
                                   class="tag-pill" onclick="event.stopPropagation();">@at.Tag?.Name</a>
                            }
                        </div>
                    }
                    @if (article.Author != null)
                    {
                        <div class="blog-author">
                            <span>by @article.Author.UserName</span>
                        </div>
                    }
                </div>
            </div>
        </a>
    }
</div>

@if (Model.TotalPages > 1)
{
    <nav aria-label="Blog pagination" class="mt-5">
        <ul class="pagination justify-content-center">
            <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                <a class="page-link" asp-action="Index"
                   asp-route-page="@(Model.CurrentPage - 1)"
                   asp-route-tag="@Model.TagFilter">‚Üê Newer</a>
            </li>

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                    <a class="page-link" asp-action="Index"
                       asp-route-page="@i"
                       asp-route-tag="@Model.TagFilter">@i</a>
                </li>
            }

            <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                <a class="page-link" asp-action="Index"
                   asp-route-page="@(Model.CurrentPage + 1)"
                   asp-route-tag="@Model.TagFilter">Older ‚Üí</a>
            </li>
        </ul>
    </nav>
}
